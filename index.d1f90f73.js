function t(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function e(e,n){return function(t,e){return e.get?e.get.call(t):e.value}(e,t(e,n,"get"))}function n(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(t,e,a){n(t,e),e.set(t,a)}function o(e,n,a){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(e,t(e,n,"set"),a),a}function r(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function i(t,e){n(t,e),e.add(t)}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const l=["#11133c","#f9ead4","#030504","#ffffff","#79fe9d","#f9a86f","#f71e4d","#060fbf","#1d43c6","#eef5f9","#c3d5e1","#f2f2f2","#fcf8f3"],s={body:1,eye:2,nosemouth:2,ear:2};function u(t){let e=0;if(0==(null==t?void 0:t.length))return e;t=t.toLowerCase();for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return Math.abs(e)}function h(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function f(t,e,n){var a=[t,e,n].map((function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}));return.2126*a[0]+.7152*a[1]+.0722*a[2]}var d=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakSet,v=new WeakSet,m=new WeakSet,S=new WeakSet,p=new WeakSet;class b{getBackgroundColor(){return o(this,g,r(this,w,C).call(this)),e(this,g)}getBodyConfig(){const t=r(this,w,C).call(this,3,e(this,g),["#030504"]);o(this,y,t);return{color:t,scale:r(this,m,R).call(this,b.bodyScaleRange,3)}}getEyesConfig(){const t=r(this,w,C).call(this,5,e(this,y)),n=r(this,v,M).call(this,"eye",5);return{color:t,scale:r(this,m,R).call(this,b.eyesScaleRange,5),distance:r(this,S,k).call(this,b.eyesDistanceRange,5),variant:n}}getNosemouthConfig(){const t=r(this,w,C).call(this,7,e(this,y)),n=r(this,v,M).call(this,"nosemouth",7);return{color:t,scale:r(this,m,R).call(this,b.nousemouthScaleRange,7),variant:n}}getEarsConfig(){const t=r(this,w,C).call(this,11,e(this,g),[e(this,y)]),n=r(this,v,M).call(this,"ear",11),a=r(this,m,R).call(this,b.earsScaleRange,11),o=r(this,S,k).call(this,b.earsRotation,11);return{color:t,scale:a,translateDeg:r(this,S,k).call(this,b.earsTranslateDegRange,11),variant:n,rotationDeg:o}}constructor(t){i(this,w),i(this,v),i(this,m),i(this,S),i(this,p),a(this,d,{writable:!0,value:void 0}),a(this,g,{writable:!0,value:void 0}),a(this,y,{writable:!0,value:void 0}),o(this,d,t)}}function C(t=1,e,n){let a=l;return e&&(a=a.filter((t=>{return n=e,a=h(t),o=h(n),r=f(a[0],a[1],a[2]),i=f(o[0],o[1],o[2]),(Math.max(r,i)+.05)/(Math.min(r,i)+.05)>b.minColorContrastRatio;var n,a,o,r,i}))),n&&(a=a.filter((t=>!n.includes(t)))),a[r(this,p,$).call(this,t)%a.length]}function M(t,e=1){return r(this,p,$).call(this,e)%s[t]}function R(t,e=1){const n=100*t[0],a=100*t[1];return(n+r(this,p,$).call(this,e)%(a-n))/100}function k(t,e=1){const n=t[0],a=t[1];return n+r(this,p,$).call(this,e)%(a-n)}function $(t){return Math.abs(Math.round(e(this,d)/t))}let A,x,N,q,D,E,T,W,B,I;c(b,"minColorContrastRatio",1.2),c(b,"bodyScaleRange",[.9,1.1]),c(b,"eyesScaleRange",[.6,.8]),c(b,"eyesDistanceRange",[48,96]),c(b,"nousemouthScaleRange",[.8,1.2]),c(b,"earsScaleRange",[.6,.8]),c(b,"earsRotation",[15,45]),c(b,"earsTranslateDegRange",[225,250]);const L={};function P(t,e){const n=L[`svg-${t}-${e}`];if(!n)throw`Can't find component with name svg-${t}-${e}`;const a=n.querySelector("g").cloneNode(!0);return a.id=`${t}-layer`,a}function j(t,e){const{color:n,offsetX:a,offsetY:o,flipHorizontal:r}=e,{scale:i}=e,c=t.querySelector("[fill]");c.setAttributeNS(null,"fill",n),c.setAttributeNS(null,"stroke",n),t.setAttributeNS(null,"transform-origin","center");const l=t.getBoundingClientRect(),s=l.width,u=l.height;O(t,`scale(${i})`);const h=t.getBoundingClientRect().width,f=t.getBoundingClientRect().height,d=x.getAttributeNS(null,"width"),g=x.getAttributeNS(null,"height");let y=0,w=0;return"path"===c.tagName?(y=Math.round(d/2-s/2)+(null!=a?a:0),w=Math.round(g/2-u/2)+(null!=o?o:0)):(y=Math.round(d/2)+(null!=a?a:0),w=Math.round(g/2)+(null!=o?o:0)),O(t,`translate(${y}, ${w})`),{width:h,height:f}}async function z(t,e,n){const a=t.querySelector("[fill]");["cx","cy","x","y"].forEach((t=>{a.hasAttributeNS(null,t)&&a.removeAttributeNS(null,t)})),x.appendChild(t)}function O(t,e){var n;let a=null!==(n=t.getAttributeNS(null,"transform"))&&void 0!==n?n:"";Array.isArray(e)||(e=[e]);const o=[a,...e].join(" ").trim();t.setAttributeNS(null,"transform",o)}async function U(t){const e=P("eye",t.variant);await z(e),Y("eye1");const n=Math.round(t.distance/2),a=j(e,{color:t.color,scale:t.scale,offsetX:n,offsetY:-24});return Y("eye2"),a}async function X(t,e,n){const a=P("ear",t.variant);await z(a),Y("ear1"),n&&(O(a,"scale(-1,1)"),Y("ear2"));const o=j(a,{color:t.color,scale:t.scale,flipHorizontal:n});Y("ear3");const r=t.translateDeg,i=Math.PI/180*r;let c=(e+o.width/2)/t.scale*Math.cos(i);n&&(c=-c),function(t,e){const{x:n,y:a}=e;O(t,`translate(${n} ${a})`)}(a,{x:c,y:((e+o.height/2)/t.scale-24)*Math.sin(i)}),Y("ear4");let l=t.translateDeg-270;return n&&(l=-l),function(t,e){const n=t.querySelector("[fill]"),a=n.getBoundingClientRect(),o=function(t,e,n,a){var o=x.createSVGPoint();o.x=t,o.y=e;var r=a.getScreenCTM();return o.matrixTransform(r.inverse())}(a.x+a.width/2,a.y+a.height/2,0,n);O(n,`rotate(${e} ${o.x} ${o.y})`)}(a,l),Y("ear5"),o}function Y(t=""){const e=document.createElement("div");e.classList.add("snapshot");const n=x.cloneNode(!0);e.append(n,t),q.prepend(e)}let H;function F(){const t=I.toDataURL();T.download="avatar",T.href=t,T.click(),T.href=null}function G(t){H=u(t),B.value=H,Q()}function V(){const t=crypto.randomUUID();W.value=t,G(t)}function _(t){var e,n;G(null!==(n=null==t||null===(e=t.currentTarget)||void 0===e?void 0:e.value)&&void 0!==n?n:"")}function J(){var t;A=document.querySelector("#stageWrapper"),x=document.querySelector("#stageSvg"),N=document.querySelector("#componentContainer"),q=document.querySelector("#snapshotContainer"),D=document.querySelector("#btnDownloadAvatar"),E=document.querySelector("#btnRandomInput"),T=document.querySelector("#downloader"),W=document.querySelector("#inputText"),B=document.querySelector("#hash"),I=document.querySelector("#canvasPreview");const e=null!==(t=window.location.search?window.location.search.substring(1):void 0)&&void 0!==t?t:"29055dff-42b8-41fc-b017-c8f589a6799e";W.value=e,H=u(W.value),B.value=H,I.width=256,I.height=256,D.addEventListener("click",F),E.addEventListener("click",V),W.addEventListener("change",_)}async function K(){const t=new Image,e=new Promise((e=>(e=>t.onload=()=>{I.getContext("2d").drawImage(t,0,0,256,256),t.onload=null,e()})(e))),n=(new XMLSerializer).serializeToString(x),a="data:image/svg+xml;base64,"+window.btoa(n);return t.src=a,e}async function Q(){Array.from(x.children).filter((t=>"background-layer"!==t.id)).forEach((t=>t.remove())),Array.from(q.children).forEach((t=>t.remove()));const t=new b(H);!function(t){const e=t.getBackgroundColor(),n=x.querySelector("g#background-layer rect");n.setAttributeNS(null,"fill",e),n.setAttributeNS(null,"stroke",e),Y("background")}(t);const e=await async function(t){const e=t.getBodyConfig(),n=P("body",0);await z(n),Y("body1");const a=j(n,{color:e.color,scale:e.scale});return Y("body2"),a}(t);await async function(t){const e=t.getEyesConfig();await U(e);const n={...e,distance:-e.distance};await U(n)}(t),await async function(t){const e=t.getNosemouthConfig(),n=P("nosemouth",e.variant);await z(n),Y("noseMouth1");const a=j(n,{color:e.color,scale:e.scale,offsetY:16});return Y("noseMouth2"),a}(t),await async function(t,e){const n=t.getEarsConfig(),a=Math.round(e.width/2);await X(n,a,!1);const o=n.translateDeg+2*(270-n.translateDeg),r={...n,translateDeg:o};await X(r,a,!0)}(t,e),K()}window.onload=async function(){J(),await async function(){for(let n=0;n<Object.keys(s).length;n++){var t=Object.keys(s)[n],e=s[t];for(let n=0;n<e;n++){const e=`/avatar-generator/components/${t}_${n}.svg`,a=await fetch(e),o=await a.text(),r=(new DOMParser).parseFromString(o,"text/xml").firstChild,i=`svg-${t}-${n}`;r.id=i,N.appendChild(r),L[i]=r}}}(),Q()};
//# sourceMappingURL=index.d1f90f73.js.map
