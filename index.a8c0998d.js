function t(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function e(e,n){return function(t,e){return e.get?e.get.call(t):e.value}(e,t(e,n,"get"))}function n(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(t,e,a){n(t,e),e.set(t,a)}function o(e,n,a){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(e,t(e,n,"set"),a),a}function r(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function i(t,e){n(t,e),e.add(t)}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const s=["#11133c","#f9ead4","#030504","#ffffff","#79fe9d","#f9a86f","#f71e4d","#060fbf","#1d43c6","#eef5f9","#c3d5e1","#f2f2f2","#fcf8f3"],c={body:1,eye:2,nosemouth:2,ear:2};var u=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakSet,g=new WeakSet,w=new WeakSet,v=new WeakSet,y=new WeakSet;class m{getBackgroundColor(){return o(this,h,r(this,d,S).call(this)),e(this,h)}getBodyConfig(){const t=r(this,d,S).call(this,3,[e(this,h),"#030504"]);o(this,f,t);return{color:t,scale:r(this,w,p).call(this,m.bodyScaleRange,3)}}getEyesConfig(){const t=r(this,d,S).call(this,5,[e(this,f)]),n=r(this,g,b).call(this,"eye",5);return{color:t,scale:r(this,w,p).call(this,m.eyesScaleRange,5),distance:r(this,v,C).call(this,m.eyesDistanceRange,5),variant:n}}getNosemouthConfig(){const t=r(this,d,S).call(this,7,[e(this,f)]),n=r(this,g,b).call(this,"nosemouth",7);return{color:t,scale:r(this,w,p).call(this,m.nousemouthScaleRange,7),variant:n}}getEarsConfig(){const t=r(this,d,S).call(this,11,[e(this,f),e(this,h)]),n=r(this,g,b).call(this,"ear",11),a=r(this,w,p).call(this,m.earsScaleRange,11),o=r(this,v,C).call(this,m.earsRotation,11);return{color:t,scale:a,translateDeg:r(this,v,C).call(this,m.earsTranslateDegRange,11),variant:n,rotation:o}}constructor(t){i(this,d),i(this,g),i(this,w),i(this,v),i(this,y),a(this,u,{writable:!0,value:void 0}),a(this,h,{writable:!0,value:void 0}),a(this,f,{writable:!0,value:void 0}),o(this,u,t)}}function S(t=1,e){const n=e?s.filter((t=>!e.includes(t))):s;return n[r(this,y,N).call(this,t)%n.length]}function b(t,e=1){return r(this,y,N).call(this,e)%c[t]}function p(t,e=1){const n=100*t[0],a=100*t[1];return(n+r(this,y,N).call(this,e)%(a-n))/100}function C(t,e=1){const n=t[0],a=t[1];return n+r(this,y,N).call(this,e)%(a-n)}function N(t){return Math.abs(Math.round(e(this,u)/t))}function R(t){let e=0;if(0==(null==t?void 0:t.length))return e;t=t.toLowerCase();for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return Math.abs(e)}let k,A,M,$,q,x,D,E,T;l(m,"bodyScaleRange",[.9,1.1]),l(m,"eyesScaleRange",[.6,.8]),l(m,"eyesDistanceRange",[48,96]),l(m,"nousemouthScaleRange",[.8,1.2]),l(m,"earsScaleRange",[.6,.8]),l(m,"earsRotation",[15,45]),l(m,"earsTranslateDegRange",[225,250]);const W={};function B(t,e){const n=W[`svg-${t}-${e}`];if(!n)throw`Can't find component with name svg-${t}-${e}`;const a=n.querySelector("g").cloneNode(!0);return a.id=`${t}-layer`,a}async function L(t){const e=B("eye",t.variant);await j(e);const n=Math.round(t.distance/2);return I(e,{color:t.color,scale:t.scale,offsetX:n,offsetY:-24})}async function P(t,e){const n=B("ear",t.variant);await j(n);const a=I(n,{color:t.color,scale:t.scale}),o=t.translateDeg,r=Math.PI/180*o;!function(t,e){const{x:n,y:a}=e;var o;let r=null!==(o=t.getAttributeNS(null,"transform"))&&void 0!==o?o:"";r+=` translate(${n} ${a})`,t.setAttributeNS(null,"transform",r.trim())}(n,{x:(e+a.width/2)/t.scale*Math.cos(r),y:(e+a.height/2)/t.scale*Math.sin(r)});return function(t,e){const n=t.querySelector("[fill]");var a;let o=null!==(a=n.getAttributeNS(null,"transform"))&&void 0!==a?a:"";const r=n.getBoundingClientRect(),i=r.x+r.width/2,l=r.y+r.height/2,s=function(t,e,n,a){var o=n.createSVGPoint();o.x=t,o.y=e;var r=a.getScreenCTM();return o.matrixTransform(r.inverse())}(i,l,A,n),c=s.x,u=s.y;o+=` rotate(${e} ${c} ${u})`,n.setAttributeNS(null,"transform",o.trim())}(n,t.translateDeg-270),a}function I(t,e){const{color:n,offsetX:a,offsetY:o}=e,{scale:r}=e,i=t.querySelector("[fill]");i.setAttributeNS(null,"fill",n),i.setAttributeNS(null,"stroke",n),t.setAttributeNS(null,"transform-origin","center");const l=t.getBoundingClientRect();var s;let c=null!==(s=t.getAttributeNS(null,"transform"))&&void 0!==s?s:"";c+=` scale(${r})`;const u=l.width,h=l.height;t.setAttributeNS(null,"transform",c);const f=t.getBoundingClientRect().width,d=t.getBoundingClientRect().height,g=A.getAttributeNS(null,"width"),w=A.getAttributeNS(null,"height");let v=0,y=0;return"path"===i.tagName?(v=Math.round(g/2-u/2)+(null!=a?a:0),y=Math.round(w/2-h/2)+(null!=o?o:0)):(v=Math.round(g/2)+(null!=a?a:0),y=Math.round(w/2)+(null!=o?o:0)),c+=` translate(${v} ${y})`,t.setAttributeNS(null,"transform",c.trim()),{width:f,height:d}}async function j(t,e,n){const a=t.querySelector("[fill]");["cx","cy","x","y"].forEach((t=>{a.hasAttributeNS(null,t)&&a.removeAttributeNS(null,t)})),A.appendChild(t)}let O;function z(){const t=T.toDataURL();x.download="avatar",x.href=t,x.click(),x.href=null}function U(t){O=R(t),E.value=O,V()}function X(){const t=crypto.randomUUID();D.value=t,U(t)}function Y(t){var e,n;U(null!==(n=null==t||null===(e=t.currentTarget)||void 0===e?void 0:e.value)&&void 0!==n?n:"")}function F(){var t;k=document.querySelector("#stageWrapper"),A=document.querySelector("#stageSvg"),M=document.querySelector("#componentContainer"),$=document.querySelector("#btnDownloadAvatar"),q=document.querySelector("#btnRandomInput"),x=document.querySelector("#downloader"),D=document.querySelector("#inputText"),E=document.querySelector("#hash"),T=document.querySelector("#canvasPreview");const e=null!==(t=window.location.search?window.location.search.substring(1):void 0)&&void 0!==t?t:"6b63bc2e-2984-4da2-b7a9-b9fe671ce986";D.value=e,O=R(D.value),E.value=O,T.width=256,T.height=256,$.addEventListener("click",z),q.addEventListener("click",X),D.addEventListener("change",Y)}async function G(){const t=new Image,e=new Promise((e=>(e=>t.onload=()=>{T.getContext("2d").drawImage(t,0,0,256,256),t.onload=null,e()})(e))),n=(new XMLSerializer).serializeToString(A),a="data:image/svg+xml;base64,"+window.btoa(n);return t.src=a,e}async function V(){Array.from(A.children).filter((t=>"background-layer"!==t.id)).forEach((t=>t.remove()));const t=new m(O);!function(t){const e=t.getBackgroundColor(),n=A.querySelector("g#background-layer rect");n.setAttributeNS(null,"fill",e),n.setAttributeNS(null,"stroke",e)}(t);const e=await async function(t){const e=t.getBodyConfig(),n=B("body",0);return await j(n),I(n,{color:e.color,scale:e.scale})}(t);await async function(t){const e=t.getEyesConfig();await L(e);const n={...e,distance:-e.distance};await L(n)}(t),await async function(t){const e=t.getNosemouthConfig(),n=B("nosemouth",e.variant);return await j(n),I(n,{color:e.color,scale:e.scale,offsetY:16})}(t),await async function(t,e){const n=t.getEarsConfig(),a=Math.round(e.width/2);await P(n,a);const o=n.translateDeg+2*(270-n.translateDeg),r=-n.rotation,i={...n,translateDeg:o,rotation:r};await P(i,a)}(t,e),G()}window.onload=async function(){F(),await async function(){for(let n=0;n<Object.keys(c).length;n++){var t=Object.keys(c)[n],e=c[t];for(let n=0;n<e;n++){const e=`/avatar-generator/components/${t}_${n}.svg`,a=await fetch(e),o=await a.text(),r=(new DOMParser).parseFromString(o,"text/xml").firstChild,i=`svg-${t}-${n}`;r.id=i,M.appendChild(r),W[i]=r}}}(),V()};
//# sourceMappingURL=index.a8c0998d.js.map
